<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!-- /fasttmp/mkdist-qt-4.4.0-1209388211/qt-win-opensource-src-4.4.0/src/sql/models/qsqlquerymodel.cpp -->
<head>
  <title>Qt 4.4: QSqlQueryModel Class Reference</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><a href="http://www.trolltech.com/products/qt"><img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /></a></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="mainclasses.html"><font color="#004faf">Main&nbsp;Classes</font></a>&nbsp;&middot; <a href="groups.html"><font color="#004faf">Grouped&nbsp;Classes</font></a>&nbsp;&middot; <a href="modules.html"><font color="#004faf">Modules</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="top" width="230"><a href="http://www.trolltech.com"><img src="images/trolltech-logo.png" align="right" width="203" height="32" border="0" /></a></td></tr></table><h1 class="title">QSqlQueryModel Class Reference<br /><span class="small-subtitle">[<a href="qtsql.html">QtSql</a> module]</span>
</h1>
<p>The QSqlQueryModel class provides a read-only data model for SQL result sets. <a href="#details">More...</a></p>
<pre> #include &lt;QSqlQueryModel&gt;</pre><p>Inherits <a href="qabstracttablemodel.html">QAbstractTableModel</a>.</p>
<p>Inherited by <a href="qsqltablemodel.html">QSqlTableModel</a>.</p>
<ul>
<li><a href="qsqlquerymodel-members.html">List of all members, including inherited members</a></li>
</ul>
<a name="public-functions"></a>
<h3>Public Functions</h3>
<ul>
<li><div class="fn"/><b><a href="qsqlquerymodel.html#QSqlQueryModel">QSqlQueryModel</a></b> ( QObject * <i>parent</i> = 0 )</li>
<li><div class="fn"/>virtual <b><a href="qsqlquerymodel.html#dtor.QSqlQueryModel">~QSqlQueryModel</a></b> ()</li>
<li><div class="fn"/>virtual bool <b><a href="qsqlquerymodel.html#canFetchMore">canFetchMore</a></b> ( const QModelIndex &amp; <i>parent</i> = QModelIndex() ) const</li>
<li><div class="fn"/>virtual void <b><a href="qsqlquerymodel.html#clear">clear</a></b> ()</li>
<li><div class="fn"/>virtual QVariant <b><a href="qsqlquerymodel.html#data">data</a></b> ( const QModelIndex &amp; <i>item</i>, int <i>role</i> = Qt::DisplayRole ) const</li>
<li><div class="fn"/>virtual void <b><a href="qsqlquerymodel.html#fetchMore">fetchMore</a></b> ( const QModelIndex &amp; <i>parent</i> = QModelIndex() )</li>
<li><div class="fn"/>virtual QVariant <b><a href="qsqlquerymodel.html#headerData">headerData</a></b> ( int <i>section</i>, Qt::Orientation <i>orientation</i>, int <i>role</i> = Qt::DisplayRole ) const</li>
<li><div class="fn"/>virtual bool <b><a href="qsqlquerymodel.html#insertColumns">insertColumns</a></b> ( int <i>column</i>, int <i>count</i>, const QModelIndex &amp; <i>parent</i> = QModelIndex() )</li>
<li><div class="fn"/>QSqlError <b><a href="qsqlquerymodel.html#lastError">lastError</a></b> () const</li>
<li><div class="fn"/>QSqlQuery <b><a href="qsqlquerymodel.html#query">query</a></b> () const</li>
<li><div class="fn"/>QSqlRecord <b><a href="qsqlquerymodel.html#record">record</a></b> ( int <i>row</i> ) const</li>
<li><div class="fn"/>QSqlRecord <b><a href="qsqlquerymodel.html#record-2">record</a></b> () const</li>
<li><div class="fn"/>virtual bool <b><a href="qsqlquerymodel.html#removeColumns">removeColumns</a></b> ( int <i>column</i>, int <i>count</i>, const QModelIndex &amp; <i>parent</i> = QModelIndex() )</li>
<li><div class="fn"/>virtual int <b><a href="qsqlquerymodel.html#rowCount">rowCount</a></b> ( const QModelIndex &amp; <i>parent</i> = QModelIndex() ) const</li>
<li><div class="fn"/>virtual bool <b><a href="qsqlquerymodel.html#setHeaderData">setHeaderData</a></b> ( int <i>section</i>, Qt::Orientation <i>orientation</i>, const QVariant &amp; <i>value</i>, int <i>role</i> = Qt::EditRole )</li>
<li><div class="fn"/>void <b><a href="qsqlquerymodel.html#setQuery">setQuery</a></b> ( const QSqlQuery &amp; <i>query</i> )</li>
<li><div class="fn"/>void <b><a href="qsqlquerymodel.html#setQuery-2">setQuery</a></b> ( const QString &amp; <i>query</i>, const QSqlDatabase &amp; <i>db</i> = QSqlDatabase() )</li>
</ul>
<ul>
<li><div class="fn"/>1 public function inherited from <a href="qabstracttablemodel.html#public-functions">QAbstractTableModel</a></li>
<li><div class="fn"/>34 public functions inherited from <a href="qabstractitemmodel.html#public-functions">QAbstractItemModel</a></li>
<li><div class="fn"/>29 public functions inherited from <a href="qobject.html#public-functions">QObject</a></li>
</ul>
<a name="protected-functions"></a>
<h3>Protected Functions</h3>
<ul>
<li><div class="fn"/>QModelIndex <b><a href="qsqlquerymodel.html#indexInQuery">indexInQuery</a></b> ( const QModelIndex &amp; <i>item</i> ) const</li>
<li><div class="fn"/>virtual void <b><a href="qsqlquerymodel.html#queryChange">queryChange</a></b> ()</li>
<li><div class="fn"/>void <b><a href="qsqlquerymodel.html#setLastError">setLastError</a></b> ( const QSqlError &amp; <i>error</i> )</li>
</ul>
<ul>
<li><div class="fn"/>14 protected functions inherited from <a href="qabstractitemmodel.html#protected-functions">QAbstractItemModel</a></li>
<li><div class="fn"/>7 protected functions inherited from <a href="qobject.html#protected-functions">QObject</a></li>
</ul>
<h3>Additional Inherited Members</h3>
<ul>
<li><div class="fn"/>1 property inherited from <a href="qobject.html#properties">QObject</a></li>
<li><div class="fn"/>2 public slots inherited from <a href="qabstractitemmodel.html#public-slots">QAbstractItemModel</a></li>
<li><div class="fn"/>1 public slot inherited from <a href="qobject.html#public-slots">QObject</a></li>
<li><div class="fn"/>14 signals inherited from <a href="qabstractitemmodel.html#signals">QAbstractItemModel</a></li>
<li><div class="fn"/>1 signal inherited from <a href="qobject.html#signals">QObject</a></li>
<li><div class="fn"/>5 static public members inherited from <a href="qobject.html#static-public-members">QObject</a></li>
</ul>
<a name="details"></a>
<hr />
<h2>Detailed Description</h2>
<p>The QSqlQueryModel class provides a read-only data model for SQL result sets.</p>
<p>QSqlQueryModel is a high-level interface for executing SQL statements and traversing the result set. It is built on top of the lower-level <a href="qsqlquery.html">QSqlQuery</a> and can be used to provide data to view classes such as <a href="qtableview.html">QTableView</a>. For example:</p>
<pre>     QSqlQueryModel *model = new QSqlQueryModel;
     model-&gt;setQuery(&quot;SELECT name, salary FROM employee&quot;);
     model-&gt;setHeaderData(0, Qt::Horizontal, tr(&quot;Name&quot;));
     model-&gt;setHeaderData(1, Qt::Horizontal, tr(&quot;Salary&quot;));

     QTableView *view = new QTableView;
     view-&gt;setModel(model);
     view-&gt;show();</pre>
<p>We set the model's query, then we set up the labels displayed in the view header.</p>
<p>QSqlQueryModel can also be used to access a database programmatically, without binding it to a view:</p>
<pre>     QSqlQueryModel model;
     model.setQuery(&quot;SELECT * FROM employee&quot;);
     int salary = model.record(4).value(&quot;salary&quot;).toInt();</pre>
<p>The code snippet above extracts the <tt>salary</tt> field from record 4 in the result set of the query <tt>SELECT * from employee</tt>. Assuming that <tt>salary</tt> is column 2, we can rewrite the last line as follows:</p>
<pre>     int salary = model.data(model.index(4, 2)).toInt();</pre>
<p>The model is read-only by default. To make it read-write, you must subclass it and reimplement <a href="qabstractitemmodel.html#setData">setData</a>() and <a href="qabstractitemmodel.html#flags">flags</a>(). Another option is to use <a href="qsqltablemodel.html">QSqlTableModel</a>, which provides a read-write model based on a single database table.</p>
<p>The <a href="sql-querymodel.html">sql/querymodel</a> example illustrates how to use QSqlQueryModel to display the result of a query. It also shows how to subclass QSqlQueryModel to customize the contents of the data before showing it to the user, and how to create a read-write model based on QSqlQueryModel.</p>
<p>If the database doesn't return the amount of selected rows in a query, the model will fetch rows incrementally. See <a href="qsqlquerymodel.html#fetchMore">fetchMore</a>() for more information.</p>
<p>See also <a href="qsqltablemodel.html">QSqlTableModel</a>, <a href="qsqlrelationaltablemodel.html">QSqlRelationalTableModel</a>, <a href="qsqlquery.html">QSqlQuery</a>, <a href="model-view-programming.html">Model/View Programming</a>, and <a href="sql-querymodel.html">Query Model Example</a>.</p>
<hr />
<h2>Member Function Documentation</h2>
<h3 class="fn"><a name="QSqlQueryModel"></a>QSqlQueryModel::QSqlQueryModel ( <a href="qobject.html">QObject</a> * <i>parent</i> = 0 )</h3>
<p>Creates an empty <a href="qsqlquerymodel.html">QSqlQueryModel</a> with the given <i>parent</i>.</p>
<h3 class="fn"><a name="dtor.QSqlQueryModel"></a>QSqlQueryModel::~QSqlQueryModel ()&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Destroys the object and frees any allocated resources.</p>
<p>See also <a href="qsqlquerymodel.html#clear">clear</a>().</p>
<h3 class="fn"><a name="canFetchMore"></a>bool QSqlQueryModel::canFetchMore ( const <a href="qmodelindex.html">QModelIndex</a> &amp; <i>parent</i> = QModelIndex() ) const&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Returns true if it is possible to read more rows from the database. This only affects databases that don't report back the size of a query (see <a href="qsqldriver.html#hasFeature">QSqlDriver::hasFeature</a>()).</p>
<p><i>parent</i> should always be an invalid <a href="qmodelindex.html">QModelIndex</a>.</p>
<p>Reimplemented from <a href="qabstractitemmodel.html#canFetchMore">QAbstractItemModel</a>.</p>
<p>This function was introduced in Qt 4.1.</p>
<p>See also <a href="qsqlquerymodel.html#fetchMore">fetchMore</a>().</p>
<h3 class="fn"><a name="clear"></a>void QSqlQueryModel::clear ()&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Clears the model and releases any acquired resource.</p>
<h3 class="fn"><a name="data"></a><a href="qvariant.html">QVariant</a> QSqlQueryModel::data ( const <a href="qmodelindex.html">QModelIndex</a> &amp; <i>item</i>, int <i>role</i> = Qt::DisplayRole ) const&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Returns the value for the specified <i>item</i> and <i>role</i>.</p>
<p>If <i>item</i> is out of bounds or if an error occurred, an invalid <a href="qvariant.html">QVariant</a> is returned.</p>
<p>Reimplemented from <a href="qabstractitemmodel.html#data">QAbstractItemModel</a>.</p>
<p>See also <a href="qsqlquerymodel.html#lastError">lastError</a>().</p>
<h3 class="fn"><a name="fetchMore"></a>void QSqlQueryModel::fetchMore ( const <a href="qmodelindex.html">QModelIndex</a> &amp; <i>parent</i> = QModelIndex() )&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Fetches more rows from a database. This only affects databases that don't report back the size of a query (see <a href="qsqldriver.html#hasFeature">QSqlDriver::hasFeature</a>()).</p>
<p>To force fetching of the entire database, you can use the following:</p>
<pre>     while (myModel-&gt;canFetchMore())
         myModel-&gt;fetchMore();</pre>
<p><i>parent</i> should always be an invalid <a href="qmodelindex.html">QModelIndex</a>.</p>
<p>Reimplemented from <a href="qabstractitemmodel.html#fetchMore">QAbstractItemModel</a>.</p>
<p>This function was introduced in Qt 4.1.</p>
<p>See also <a href="qsqlquerymodel.html#canFetchMore">canFetchMore</a>().</p>
<h3 class="fn"><a name="headerData"></a><a href="qvariant.html">QVariant</a> QSqlQueryModel::headerData ( int <i>section</i>, <a href="qt.html#Orientation-enum">Qt::Orientation</a> <i>orientation</i>, int <i>role</i> = Qt::DisplayRole ) const&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Returns the header data for the given <i>role</i> in the <i>section</i> of the header with the specified <i>orientation</i>.</p>
<p>Reimplemented from <a href="qabstractitemmodel.html#headerData">QAbstractItemModel</a>.</p>
<p>See also <a href="qsqlquerymodel.html#setHeaderData">setHeaderData</a>().</p>
<h3 class="fn"><a name="indexInQuery"></a><a href="qmodelindex.html">QModelIndex</a> QSqlQueryModel::indexInQuery ( const <a href="qmodelindex.html">QModelIndex</a> &amp; <i>item</i> ) const&nbsp;&nbsp;<tt> [protected]</tt></h3>
<p>Returns the index of the value in the database result set for the given <i>item</i> in the model.</p>
<p>The return value is identical to <i>item</i> if no columns or rows have been inserted, removed, or moved around.</p>
<p>Returns an invalid model index if <i>item</i> is out of bounds or if <i>item</i> does not point to a value in the result set.</p>
<p>See also <a href="qsqltablemodel.html#indexInQuery">QSqlTableModel::indexInQuery</a>(), <a href="qsqlquerymodel.html#insertColumns">insertColumns</a>(), and <a href="qsqlquerymodel.html#removeColumns">removeColumns</a>().</p>
<h3 class="fn"><a name="insertColumns"></a>bool QSqlQueryModel::insertColumns ( int <i>column</i>, int <i>count</i>, const <a href="qmodelindex.html">QModelIndex</a> &amp; <i>parent</i> = QModelIndex() )&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Inserts <i>count</i> columns into the model at position <i>column</i>. The <i>parent</i> parameter must always be an invalid <a href="qmodelindex.html">QModelIndex</a>, since the model does not support parent-child relationships.</p>
<p>Returns true if <i>column</i> is within bounds; otherwise returns false.</p>
<p>By default, inserted columns are empty. To fill them with data, reimplement <a href="qsqlquerymodel.html#data">data</a>() and handle any inserted column separately:</p>
<pre> QVariant MyModel::data(const QModelIndex &amp;item, int role) const
 {
     if (item.column() == m_specialColumnNo) {
         <span class="comment">//</span> handle column separately
     }
     return QSqlQueryModel::data(item, role);
 }</pre>
<p>Reimplemented from <a href="qabstractitemmodel.html#insertColumns">QAbstractItemModel</a>.</p>
<p>See also <a href="qsqlquerymodel.html#removeColumns">removeColumns</a>().</p>
<h3 class="fn"><a name="lastError"></a><a href="qsqlerror.html">QSqlError</a> QSqlQueryModel::lastError () const</h3>
<p>Returns information about the last error that occurred on the database.</p>
<p>See also <a href="qsqlquerymodel.html#setLastError">setLastError</a>().</p>
<h3 class="fn"><a name="query"></a><a href="qsqlquery.html">QSqlQuery</a> QSqlQueryModel::query () const</h3>
<p>Returns the <a href="qsqlquery.html">QSqlQuery</a> associated with this model.</p>
<p>See also <a href="qsqlquerymodel.html#setQuery">setQuery</a>().</p>
<h3 class="fn"><a name="queryChange"></a>void QSqlQueryModel::queryChange ()&nbsp;&nbsp;<tt> [virtual protected]</tt></h3>
<p>This virtual function is called whenever the query changes. The default implementation does nothing.</p>
<p><a href="qsqlquerymodel.html#query">query</a>() returns the new query.</p>
<p>See also <a href="qsqlquerymodel.html#query">query</a>() and <a href="qsqlquerymodel.html#setQuery">setQuery</a>().</p>
<h3 class="fn"><a name="record"></a><a href="qsqlrecord.html">QSqlRecord</a> QSqlQueryModel::record ( int <i>row</i> ) const</h3>
<p>Returns the record containing information about the fields of the current query. If <i>row</i> is the index of a valid row, the record will be populated with values from that row.</p>
<p>If the model is not initialized, an empty record will be returned.</p>
<p>See also <a href="qsqlrecord.html#isEmpty">QSqlRecord::isEmpty</a>().</p>
<h3 class="fn"><a name="record-2"></a><a href="qsqlrecord.html">QSqlRecord</a> QSqlQueryModel::record () const</h3>
<p>This is an overloaded member function, provided for convenience.</p>
<p>Returns an empty record containing information about the fields of the current query.</p>
<p>If the model is not initialized, an empty record will be returned.</p>
<p>See also <a href="qsqlrecord.html#isEmpty">QSqlRecord::isEmpty</a>().</p>
<h3 class="fn"><a name="removeColumns"></a>bool QSqlQueryModel::removeColumns ( int <i>column</i>, int <i>count</i>, const <a href="qmodelindex.html">QModelIndex</a> &amp; <i>parent</i> = QModelIndex() )&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Removes <i>count</i> columns from the model starting from position <i>column</i>. The <i>parent</i> parameter must always be an invalid <a href="qmodelindex.html">QModelIndex</a>, since the model does not support parent-child relationships.</p>
<p>Removing columns effectively hides them. It does not affect the underlying <a href="qsqlquery.html">QSqlQuery</a>.</p>
<p>Returns true if the columns were removed; otherwise returns false.</p>
<p>Reimplemented from <a href="qabstractitemmodel.html#removeColumns">QAbstractItemModel</a>.</p>
<h3 class="fn"><a name="rowCount"></a>int QSqlQueryModel::rowCount ( const <a href="qmodelindex.html">QModelIndex</a> &amp; <i>parent</i> = QModelIndex() ) const&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>If the database supports returning the size of a query (see <a href="qsqldriver.html#hasFeature">QSqlDriver::hasFeature</a>()), the amount of rows of the current query is returned. Otherwise, returns the amount of rows currently cached on the client.</p>
<p><i>parent</i> should always be an invalid <a href="qmodelindex.html">QModelIndex</a>.</p>
<p>Reimplemented from <a href="qabstractitemmodel.html#rowCount">QAbstractItemModel</a>.</p>
<p>This function was introduced in Qt 4.1.</p>
<p>See also <a href="qsqlquerymodel.html#canFetchMore">canFetchMore</a>() and <a href="qsqldriver.html#hasFeature">QSqlDriver::hasFeature</a>().</p>
<h3 class="fn"><a name="setHeaderData"></a>bool QSqlQueryModel::setHeaderData ( int <i>section</i>, <a href="qt.html#Orientation-enum">Qt::Orientation</a> <i>orientation</i>, const <a href="qvariant.html">QVariant</a> &amp; <i>value</i>, int <i>role</i> = Qt::EditRole )&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Sets the caption for a horizontal header for the specified <i>role</i> to <i>value</i>. This is useful if the model is used to display data in a view (e.g&#x2e;, <a href="qtableview.html">QTableView</a>).</p>
<p>Returns true if <i>orientation</i> is <a href="qt.html#Orientation-enum">Qt::Horizontal</a> and the <i>section</i> refers to a valid section; otherwise returns false.</p>
<p>Note that this function cannot be used to modify values in the database since the model is read-only.</p>
<p>Reimplemented from <a href="qabstractitemmodel.html#setHeaderData">QAbstractItemModel</a>.</p>
<p>See also <a href="qsqlquerymodel.html#headerData">headerData</a>() and <a href="qsqlquerymodel.html#data">data</a>().</p>
<h3 class="fn"><a name="setLastError"></a>void QSqlQueryModel::setLastError ( const <a href="qsqlerror.html">QSqlError</a> &amp; <i>error</i> )&nbsp;&nbsp;<tt> [protected]</tt></h3>
<p>Protected function which allows derived classes to set the value of the last error that occurred on the database to <i>error</i>.</p>
<p>See also <a href="qsqlquerymodel.html#lastError">lastError</a>().</p>
<h3 class="fn"><a name="setQuery"></a>void QSqlQueryModel::setQuery ( const <a href="qsqlquery.html">QSqlQuery</a> &amp; <i>query</i> )</h3>
<p>Resets the model and sets the data provider to be the given <i>query</i>. Note that the query must be active and must not be isForwardOnly().</p>
<p><a href="qsqlquerymodel.html#lastError">lastError</a>() can be used to retrieve verbose information if there was an error setting the query.</p>
<p>See also <a href="qsqlquerymodel.html#query">query</a>(), <a href="qsqlquery.html#isActive">QSqlQuery::isActive</a>(), <a href="qsqlquery.html#setForwardOnly">QSqlQuery::setForwardOnly</a>(), and <a href="qsqlquerymodel.html#lastError">lastError</a>().</p>
<h3 class="fn"><a name="setQuery-2"></a>void QSqlQueryModel::setQuery ( const <a href="qstring.html">QString</a> &amp; <i>query</i>, const <a href="qsqldatabase.html">QSqlDatabase</a> &amp; <i>db</i> = QSqlDatabase() )</h3>
<p>This is an overloaded member function, provided for convenience.</p>
<p>Executes the query <i>query</i> for the given database connection <i>db</i>. If no database is specified, the default connection is used.</p>
<p><a href="qsqlquerymodel.html#lastError">lastError</a>() can be used to retrieve verbose information if there was an error setting the query.</p>
<p>Example:</p>
<pre>     QSqlQueryModel model;
     model.setQuery(&quot;select * from MyTable&quot;);
     if (model.lastError().isValid())
         qDebug() &lt;&lt; model.lastError();</pre>
<p>See also <a href="qsqlquerymodel.html#query">query</a>(), <a href="qsqlquerymodel.html#queryChange">queryChange</a>(), and <a href="qsqlquerymodel.html#lastError">lastError</a>().</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td width="30%">Copyright &copy; 2008 <a href="trolltech.html">Trolltech</a></td>
<td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
<td width="30%" align="right"><div align="right">Qt 4.4.0</div></td>
</tr></table></div></address></body>
</html>
